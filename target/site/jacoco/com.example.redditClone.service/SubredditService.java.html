<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SubredditService.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">redditClone</a> &gt; <a href="index.source.html" class="el_package">com.example.redditClone.service</a> &gt; <span class="el_source">SubredditService.java</span></div><h1>SubredditService.java</h1><pre class="source lang-java linenums">package com.example.redditClone.service;

import com.example.redditClone.dto.SubredditDTO;
import com.example.redditClone.exception.SubredditNotFoundException;
import com.example.redditClone.models.Subreddit;
import com.example.redditClone.repository.SubredditRepository;
import lombok.AllArgsConstructor;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.time.Instant;
import java.util.List;
import java.util.stream.Collectors;
import java.util.stream.StreamSupport;

@Service
<span class="fc" id="L17">@AllArgsConstructor</span>
public class SubredditService {

    private final SubredditRepository subredditRepository;
    private final AuthService authService;

    // get a subreddit and map to what a user can see, example get one or many subreddits.
    private SubredditDTO mapToDTO (Subreddit subreddit) {
<span class="fc" id="L25">        return SubredditDTO.builder()</span>
<span class="fc" id="L26">                .id(subreddit.getId())</span>
<span class="fc" id="L27">                .name(subreddit.getName())</span>
<span class="fc" id="L28">                .description(subreddit.getDescription())</span>
<span class="fc" id="L29">                .postCount(subreddit.getPosts().size())</span>
<span class="fc" id="L30">                .build();</span>

    }

    // maps to subreddit to be send to th db for creation of subreddit.
    private Subreddit mapToSubreddit (SubredditDTO subredditDTO) {
<span class="fc" id="L36">        return Subreddit.builder().name(subredditDTO.getName())</span>
<span class="fc" id="L37">                .description(subredditDTO.getDescription())</span>
<span class="fc" id="L38">                .user(authService.getCurrentUser())</span>
<span class="fc" id="L39">                .creationDate(Instant.now())</span>
<span class="fc" id="L40">                .build();</span>

    }

    @Transactional(readOnly = true)
    public List&lt;SubredditDTO&gt; getAll() {
<span class="fc" id="L46">        return StreamSupport</span>
<span class="fc" id="L47">                .stream(subredditRepository.findAll().spliterator(), false)</span>
<span class="fc" id="L48">                .map(this::mapToDTO)</span>
<span class="fc" id="L49">                .collect(Collectors.toList());</span>
    }


//    @Test
//    public void whenConvertedToList_thenCorrect() {
//        Iterable&lt;String&gt; iterable
//                = Arrays.asList(&quot;Testing&quot;, &quot;Iterable&quot;, &quot;conversion&quot;, &quot;to&quot;, &quot;Stream&quot;);
//
//        List&lt;String&gt; result = StreamSupport.stream(iterable.spliterator(), false)
//                .map(String::toUpperCase)
//                .collect(Collectors.toList());
//
//        assertThat(
//                result, contains(&quot;TESTING&quot;, &quot;ITERABLE&quot;, &quot;CONVERSION&quot;, &quot;TO&quot;, &quot;STREAM&quot;));
//    }


    @Transactional
    public SubredditDTO save(SubredditDTO subredditDTO) {
<span class="fc" id="L69">        Subreddit subreddit = subredditRepository.save(mapToSubreddit(subredditDTO));</span>
<span class="fc" id="L70">        subredditDTO.setId(subreddit.getId());</span>
<span class="fc" id="L71">        return subredditDTO;</span>
    }

    @Transactional(readOnly = true)
    public SubredditDTO getSubreddit(Long id) {
<span class="fc" id="L76">        Subreddit subreddit = subredditRepository.findById(id)</span>
<span class="fc" id="L77">                .orElseThrow(() -&gt; new SubredditNotFoundException(&quot;Subreddit not found with id -&quot; + id));</span>
<span class="fc" id="L78">        return mapToDTO(subreddit);</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.3.201901230119</span></div></body></html>